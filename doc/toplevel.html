<h1>Overview</h1>

<p>AMI2 is a distributed visualization system for use with LCLS-II Free Electron Laser.
It is a rewrite of the previous AMI package.</p>

<h2>Data flow</h2>

<p>Please see the System Diagram below.
Data flows in real time from sensors and are delivered to a cluster in the form of Events.
Event data is distributed round-robin to nodes of the cluster where it is deposited in a shared memory region.
A Worker process picks up the data and passes it through a Computation Graph according to the needs of the current clients.
Results from the Computation Graph are accumulated in Collector processes, after which they are passed to the Feature Store.
Client processes (GUIs and devices) access data from the Feature Store.
Clients specify the form of the Computation Graph by communicating with the Graph Manager.</p>

<h2>System Diagram</h2>

<p><img src="images/AMI2_system_diagram.jpg" width=800></p>

<h3>Event1, ...</h3>

<p>Data delivery events from sensors, distributed round-robin to nodes.</p>

<h3>Node1, ...</h3>

<p>Compute nodes in the cluster.</p>

<h3>shmem</h3>

<p>Shared memory region into which event data is delivered.</p>

<h3>W1, ...</h3>

<p>Python worker processes perform computation on the data.</p>

<h3>C1, ...</h3>

<p>Python collector process assembles cumulative data.</p>

<h3>Feature Store</h3>

<p>API from which clients can subscribe to data (should be dsitributed)</p>

<h3>Graph Manager</h3>

<p>Python processes that manipulate and optimize the computation graph</p>

<h3>GUI Client</h3>

<p>Python process that sends requests to the graph manager and receives data from Feature store.</p>

<h3>Epics</h3>

<p>Data communication protocal used by DOE labs for instrumentation</p>

<h2>Project Goals</h2>

<p>Robust to node or process failure, recover from crash</p>

<p>multiple users can simultaneously edit the computation graph (at low rates)</p>

<p>Scalable to clusters of any size including supercomputers</p>

<p>Drive it online from shared memory event mechanism, or offline from a file</p>

<p>Portable, no Psana dependencies (or isolate them), hardware agnostic Linux/IA, any network</p>

<p>Follow well defined coding conventions, good project hygiene and testing</p>

<p>Extensible - new clients, new GUI elements, new Computation Graph operations</p>

<p>Two version, one with Legion and another without</p>

<p>Epics protocol to send data to clients, also for clients to make requests</p>

<p>"sum all", "pick 1", "sum 1" style calculations</p>

<h2>First milestone</h2>

<p>The first milestone is a generic use case of the most common features, driven from
a canned example.
This will also consitute the first test in a suite of tests.</p>
